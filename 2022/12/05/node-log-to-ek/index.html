<!DOCTYPE html>
<html lang="zh-cn">
  <head><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="description" content="Node.jsã€Elasticsearchã€Kibana æ—¥å¿—ä¸ŠæŠ¥å®æˆ˜"/><meta name="keywords" content="å¼€å‘ã€æŠ€æœ¯ã€å‰ç«¯ã€ç”Ÿæ´»æ„Ÿæ‚Ÿã€æ€è€ƒ" /><link rel="alternate" href="/default" title="Jz de boke"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.0" />
<link rel="canonical" href="http://yoursite.com/2022/12/05/node-log-to-ek/"/>

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.0" />

<script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script src="//cdn1.lncld.net/static/js/3.1.1/av-min.js"></script>
  <script id="leancloud">
    AV.init({
      appId: "uMdsaHD1FNsezx8GJwYPHtfe-gzGzoHsz",
      appKey: "WM7KSHWQxXSOlxGBieADbzMy"
    });
  </script><script>
  window.config = {"leancloud":{"app_id":"uMdsaHD1FNsezx8GJwYPHtfe-gzGzoHsz","app_key":"WM7KSHWQxXSOlxGBieADbzMy"},"toc":true,"fancybox":true,"pjax":"","latex":false};
</script>

    <title>Node.jsã€Elasticsearchã€Kibana æ—¥å¿—ä¸ŠæŠ¥å®æˆ˜ - Jz de boke</title>
  <meta name="generator" content="Hexo 4.2.1"></head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Jz de boke</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/">
        <li class="mobile-menu-item">é¦–é¡µ
          </li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">åˆ†ç±»
          </li>
      </a><a href="/about/">
        <li class="mobile-menu-item">å…³äº
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Jz de boke</a>
</div>

<nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item">
          <a class="menu-item-link" href="/">
            é¦–é¡µ
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/categories/">
            åˆ†ç±»
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/about/">
            å…³äº
            </a>
        </li>
      </ul></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><article class="post">
    <header class="post-header">
      <h1 class="post-title">Node.jsã€Elasticsearchã€Kibana æ—¥å¿—ä¸ŠæŠ¥å®æˆ˜
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2022-12-05
        </span><span class="post-category">
            <a href="/categories/%E6%8A%80%E6%9C%AF/">æŠ€æœ¯</a>
            </span>
        <span class="post-visits"
             data-url="/2022/12/05/node-log-to-ek/"
             data-title="Node.jsã€Elasticsearchã€Kibana æ—¥å¿—ä¸ŠæŠ¥å®æˆ˜">
          é˜…è¯»æ¬¡æ•° 0
        </span>
        </div>
    </header>

    <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">ç›®å½•</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#èƒŒæ™¯"><span class="toc-text">èƒŒæ™¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å®‰è£…-ESã€Kibana"><span class="toc-text">å®‰è£… ESã€Kibana</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Node-æ—¥å¿—ä¸ŠæŠ¥åˆ°-ES"><span class="toc-text">Node æ—¥å¿—ä¸ŠæŠ¥åˆ° ES</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä½¿ç”¨-Kibana-æŸ¥çœ‹æ—¥å¿—"><span class="toc-text">ä½¿ç”¨ Kibana æŸ¥çœ‹æ—¥å¿—</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å°è£…æ›´å¥½ç”¨çš„-SDK"><span class="toc-text">å°è£…æ›´å¥½ç”¨çš„ SDK</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å‚è€ƒ"><span class="toc-text">å‚è€ƒ</span></a></li></ol>
    </div>
  </div><div class="post-content"><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>è¦ä½¿ç”¨æ—¥å¿—æŸ¥è¯¢æœåŠ¡å¯ä»¥ç›´æ¥è´­ä¹°äº‘å‚å•†çš„ï¼Œæ¯”å¦‚é˜¿é‡Œäº‘çš„ SLSã€è…¾è®¯äº‘çš„ CLSã€‚ å¦‚æœè¦è‡ªå·±å®ç°æ—¥å¿—ä¸ŠæŠ¥ï¼Œä¸€èˆ¬åšæ³•æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>ç”¨ Filebeat ä»æ–‡ä»¶æ”¶é›†æ—¥å¿—åšæ—¥å¿—è¿‡æ»¤ã€æ¸…æ´—ã€‚</li>
<li>Filebeat å¤„ç†åçš„æ—¥å¿—å‘é€åˆ° Kafka å‰Šå³°å¤„ç†ã€‚</li>
<li>Logstash ä» Kafka è¯»å–æ—¥å¿—å­˜å‚¨åˆ° Elasticsearchï¼ˆä»¥ä¸‹ç®€ç§° ESï¼‰ã€‚</li>
<li>å¼€å‘è€…åœ¨ Kibana è¿›è¡Œæ—¥å¿—æŸ¥è¯¢ã€‚</li>
</ul>
<p><img src="/images/node-log-to-ek/img6.png" alt=""></p>
<p>æˆ‘ä»¬å›¢é˜Ÿç›®å‰çš„éœ€æ±‚æ˜¯æŠŠå†…éƒ¨ Node æœåŠ¡æ—¥å¿—ä¸ŠæŠ¥åˆ° ESï¼Œæµé‡ä¸å¤§ï¼Œæ‰€ä»¥é‡‡ç”¨ç®€å•çš„åšæ³•ã€‚Node ç›´æ¥å°†æ—¥å¿—å­˜å‚¨åˆ° ESï¼Œä½¿ç”¨ Kibana ç”¨å¯è§†åŒ–çš„æ–¹å¼è¿›è¡Œ ES æŸ¥è¯¢æ—¥å¿—ã€‚</p>
<p><img src="/images/node-log-to-ek/img7.png" alt=""></p>
<p>æ¥ä¸‹æ¥å°†ä¸ºå¤§å®¶ä»‹ç»å¦‚ä½•æ­å»ºè¿™ä¸ªæ¶æ„ï¼Œå¦‚ä½•å°è£…ç”¨æˆ·ä½“éªŒè‰¯å¥½çš„ Node æ—¥å¿—ä¸ŠæŠ¥ SDKã€‚ES æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œæœ¬æ–‡ä»¥ 7.17 ä¸ºä¾‹è¿›è¡Œè®²è§£ã€‚</p>
<h2 id="å®‰è£…-ESã€Kibana"><a href="#å®‰è£…-ESã€Kibana" class="headerlink" title="å®‰è£… ESã€Kibana"></a>å®‰è£… ESã€Kibana</h2><p>ä¸‹é¢æ¶‰åŠåˆ°å®‰è£…çš„æ­¥éª¤éƒ½ä»¥ MacOS ä¸ºä¾‹è¿›è¡Œè®²è§£ï¼Œå…¶ä»–æ“ä½œç³»ç»Ÿå¯ä»¥å‚è€ƒ <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/targz.html" target="_blank" rel="noopener">ã€ŠSet up Elasticsearchã€‹</a> è¿›è¡Œæ“ä½œã€‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£… ESã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> brew tap elastic/tap</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> brew install elastic/tap/elasticsearch-full</span></span><br></pre></td></tr></table></figure>

<p>å®‰è£…å®Œæˆï¼Œåœ¨æ§åˆ¶å°æ‰§è¡Œ <code>elasticsearch</code> å‘½ä»¤å¯åŠ¨ ESï¼Œå¯åŠ¨åå¦‚æœèƒ½æ­£å¸¸è®¿é—® <a href="http://localhost:9200" target="_blank" rel="noopener">http://localhost:9200</a> è¡¨ç¤ºå¯åŠ¨æˆåŠŸã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl http://localhost:9200</span></span><br><span class="line">&#123;</span><br><span class="line">  "name" : "jinzhanyedeMacBook-Pro.local",</span><br><span class="line">  "cluster_name" : "elasticsearch_jinzhanye",</span><br><span class="line">  "cluster_uuid" : "U4ob5U_CQXifCe_FgI183A",</span><br><span class="line">  "version" : &#123;</span><br><span class="line">    "number" : "7.17.4",</span><br><span class="line">    "build_flavor" : "default",</span><br><span class="line">    "build_type" : "tar",</span><br><span class="line">    "build_hash" : "79878662c54c886ae89206c685d9f1051a9d6411",</span><br><span class="line">    "build_date" : "2022-05-18T18:04:20.964345128Z",</span><br><span class="line">    "build_snapshot" : false,</span><br><span class="line">    "lucene_version" : "8.11.1",</span><br><span class="line">    "minimum_wire_compatibility_version" : "6.8.0",</span><br><span class="line">    "minimum_index_compatibility_version" : "6.0.0-beta1"</span><br><span class="line">  &#125;,</span><br><span class="line">  "tagline" : "You Know, for Search"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£… Kibanaã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> brew tap elastic/tap</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> brew install elastic/tap/kibana-full</span></span><br></pre></td></tr></table></figure>

<p>å®‰è£…å®Œæˆï¼Œå¹¶ç¡®å®š ES å·²ç»å¯åŠ¨æˆåŠŸåï¼Œæ§åˆ¶å°æ‰§è¡Œ <code>kibana</code> å‘½ä»¤å¯åŠ¨ Kibanaã€‚å¯åŠ¨åå¦‚ä½•èƒ½æ­£å¸¸è®¿é—® <a href="http://localhost:5601" target="_blank" rel="noopener">http://localhost:5601</a> è¡¨ç¤ºå¯åŠ¨æˆåŠŸã€‚</p>
<p><img src="/images/node-log-to-ek/img2.png" alt=""></p>
<p>è‡³æ­¤æˆ‘ä»¬å·²ç»æŠŠç¯å¢ƒæ­å»ºå®Œæ¯•ï¼Œåœ¨è¿›å…¥ä¸‹ä¸€å°èŠ‚ä¹‹å‰å¦‚æœä¹‹å‰æ²¡æœ‰æ¥è§¦è¿‡ ESï¼Œå¯ä»¥çœ‹çœ‹é˜®è€å¸ˆçš„æ–‡ç«  <a href="https://www.ruanyifeng.com/blog/2017/08/elasticsearch.html" target="_blank" rel="noopener">ã€Šå…¨æ–‡æœç´¢å¼•æ“ Elasticsearch å…¥é—¨æ•™ç¨‹ã€‹</a> ç®€å•äº†è§£ä¸€ä¸‹ï¼Œæœ‰åˆ©äºæ¶ˆåŒ–åé¢çš„å†…å®¹ã€‚é˜®è€å¸ˆæ–‡ç« é‡Œæåˆ°çš„å‘½ä»¤ä¹Ÿå¯ä»¥åœ¨ <a href="http://localhost:5601/app/dev_tools#/console" target="_blank" rel="noopener">Kibana Dev Tools</a> æ‰§è¡Œï¼Œå†…å®¹è¢«æ ¼å¼åŒ–åé˜…è¯»ä½“éªŒæ›´ä½³ã€‚</p>
<h2 id="Node-æ—¥å¿—ä¸ŠæŠ¥åˆ°-ES"><a href="#Node-æ—¥å¿—ä¸ŠæŠ¥åˆ°-ES" class="headerlink" title="Node æ—¥å¿—ä¸ŠæŠ¥åˆ° ES"></a>Node æ—¥å¿—ä¸ŠæŠ¥åˆ° ES</h2><p>Node æ—¥å¿—ä¸ŠæŠ¥åˆ° ES å‚è€ƒè¿™ä¸ª <a href="http.baidu.com">Demo</a>ï¼Œæˆ‘ä»¬ä½¿ç”¨ <a href="https://www.npmjs.com/package/winston" target="_blank" rel="noopener">winston</a> æ‰“å°æ—¥å¿—ï¼Œä½¿ç”¨ <a href="https://www.npmjs.com/package/winston-elasticsearch" target="_blank" rel="noopener">winston-elasticsearch</a> ä¸ŠæŠ¥æ—¥å¿—åˆ° ESã€‚å¦‚ä¸‹é¢ä»£ç é…ç½®æ‰€ç¤º winston-elasticsearch æ¯å¤©æ–°å»ºä¸€ä¸ªå‘½åä¸º simple-es-logger-demo-YYYY.MM.DD çš„ indexã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * es-logger.js</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">createLogger</span>: createWinstonLogger, transports, format &#125; = <span class="built_in">require</span>(<span class="string">'winston'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; ElasticsearchTransport &#125; = <span class="built_in">require</span>(<span class="string">'winston-elasticsearch'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> esNode = <span class="string">'http://localhost:9200'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createLogger</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> createWinstonLogger(&#123;</span><br><span class="line">    level: <span class="string">'info'</span>,<span class="comment">// åªä¸ŠæŠ¥ info çº§åˆ«ä»¥ä¸Šæ—¥å¿—ï¼ŒåŒ…æ‹¬ infoã€warnã€error</span></span><br><span class="line">    transports: [</span><br><span class="line">      <span class="keyword">new</span> transports.Console(&#123;<span class="comment">// è¾“å‡ºåˆ°æ§åˆ¶å°</span></span><br><span class="line">        format: format.json(),</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> ElasticsearchTransport(&#123;<span class="comment">// è¾“å‡ºåˆ° ES</span></span><br><span class="line">        indexPrefix: <span class="string">'simple-es-logger-demo'</span>,<span class="comment">// ES index å‰ç¼€</span></span><br><span class="line">        indexSuffixPattern: <span class="string">'YYYY.MM.DD'</span>,<span class="comment">// ES index åç¼€ï¼Œè·Ÿå‰ç¼€æ‹¼æ¥èµ·æ¥ index æœ€ç»ˆå°±æ˜¯ simple-es-logger-demo-YYYY.MM.DDï¼Œå¦‚ simple-es-logger-demo-2023.01.12</span></span><br><span class="line">        clientOpts: &#123;</span><br><span class="line">          node: esNode,</span><br><span class="line">          maxRetries: <span class="number">5</span>,</span><br><span class="line">          requestTimeout: <span class="number">10000</span>,</span><br><span class="line">          sniffOnStart: <span class="literal">false</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    ]</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = createLogger()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Compatibility For Winston 3.7, Elasticsearch 8.0 and later, use the &gt;= 0.17.0. For Winston 3.4, Elasticsearch 7.8 and later, use the &gt;= 0.16.0. For Winston 3.x, Elasticsearch 7.0 and later, use the &gt;= 0.7.0. For Elasticsearch 6.0 and later, use the 0.6.0. For Elasticsearch 5.0 and later, use the 0.5.9. For earlier versions, use the 0.4.x series.</p>
</blockquote>
<p>è¿™é‡Œç‰ˆæœ¬çš„é—®é¢˜éœ€è¦æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ ES 7.17ï¼Œä» winston-elasticsearch çš„æ–‡æ¡£å¯ä»¥å¾—çŸ¥ï¼Œwinston éœ€è¦é€‰æ‹© 3.4 ç‰ˆæœ¬ï¼Œ winston-elasticsearch éœ€è¦é€‰æ‹© &gt;= 0.16.0 çš„ç‰ˆæœ¬ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; package.json</span><br><span class="line">&quot;dependencies&quot;: &#123;</span><br><span class="line">  &quot;koa&quot;: &quot;^2.5.2&quot;,</span><br><span class="line">  &quot;winston&quot;: &quot;3.4.0&quot;,</span><br><span class="line">  &quot;winston-elasticsearch&quot;: &quot;0.16.1&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬ç”¨ Koa æ­å»ºä¸€ä¸ªç®€å•çš„æœåŠ¡ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * index.js</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"><span class="keyword">const</span> logger = <span class="built_in">require</span>(<span class="string">'./es-logger'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> body = &#123;</span><br><span class="line">    message: <span class="string">`æœåŠ¡è¢«è®¿é—®äº†ï¼Œç”Ÿæˆéšæœºæ•°ï¼š<span class="subst">$&#123; <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">100</span>) &#125;</span>`</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  logger.info(<span class="built_in">JSON</span>.stringify(body))</span><br><span class="line"></span><br><span class="line">  ctx.body = body</span><br><span class="line"></span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">7115</span></span><br><span class="line"></span><br><span class="line">app.listen(port, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`æœåŠ¡å¯åŠ¨æˆåŠŸï¼Œhttp://localhost:<span class="subst">$&#123;<span class="number">7115</span>&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>è®¿é—® <a href="http://localhost:7115" target="_blank" rel="noopener">http://localhost:7115</a>ï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl http:&#x2F;&#x2F;localhost:7115</span><br><span class="line">&#123;&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;&#123;\&quot;message\&quot;:\&quot;æœåŠ¡è¢«è®¿é—®äº†ï¼Œç”Ÿæˆéšæœºæ•°ï¼š14\&quot;&#125;&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ çš„æ§åˆ¶å°æ²¡æœ‰æŠ¥é”™ï¼Œè¯´æ˜æ—¥å¿—å·²ç»ä¸ŠæŠ¥åˆ° ESã€‚winston-elasticsearch å°†æ—¥å¿—æ ¼å¼åŒ–æˆè¿™æ ·å†è¿›è¡Œå‘é€ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;@timestamp&quot;: &quot;2022-12-07T06:19:24.969Z&quot;,</span><br><span class="line">  &quot;message&quot;: &quot;&#123;\&quot;message\&quot;:\&quot;æœåŠ¡è¢«è®¿é—®äº†ï¼Œç”Ÿæˆéšæœºæ•°ï¼š14\&quot;&#125;&quot;,</span><br><span class="line">  &quot;severity&quot;: &quot;info&quot;,</span><br><span class="line">  &quot;fields&quot;: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ Kibana æŸ¥çœ‹æˆ‘ä»¬ä¸ŠæŠ¥çš„æ—¥å¿—ã€‚</p>
<h2 id="ä½¿ç”¨-Kibana-æŸ¥çœ‹æ—¥å¿—"><a href="#ä½¿ç”¨-Kibana-æŸ¥çœ‹æ—¥å¿—" class="headerlink" title="ä½¿ç”¨ Kibana æŸ¥çœ‹æ—¥å¿—"></a>ä½¿ç”¨ Kibana æŸ¥çœ‹æ—¥å¿—</h2><p>åœ¨é¦–é¡µå·¦ä¾§é¢æ¿å¯¼èˆªæ‰¾åˆ° Management -&gt; Stack Managementï¼Œç‚¹å‡»è¿›å…¥ Stack Managementã€‚å†åœ¨å·¦ä¾§å¯¼èˆªæ‰¾åˆ° <a href="http://localhost:5601/app/management/kibana/indexPatterns" target="_blank" rel="noopener">Index Patterns</a>ã€‚Name è¾“å…¥ <code>simple-es-logger-demo-*</code>ï¼Œè¿‡æ»¤ä»¥ <code>simple-es-logger-demo</code> å¼€å¤´çš„ indexã€‚Timestamp field é€‰æ‹© @timestampã€‚</p>
<p><img src="/images/node-log-to-ek/img3.png" alt=""></p>
<p>åœ¨é¦–é¡µå·¦ä¾§é¢æ¿å¯¼èˆªæ‰¾åˆ° Discoveryï¼Œé€‰æ‹©è¿‡æ»¤ <code>simple-es-logger-demo-*</code>ï¼Œå°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¸ŠæŠ¥çš„æ—¥å¿—ã€‚</p>
<p><img src="/images/node-log-to-ek/img4.png" alt=""></p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ KQL è¯­æ³•æ ¹æ®å…³é”®å­—è¿‡æ»¤æ—¥å¿—ï¼Œæ¯”å¦‚è¾“å…¥ <code>message: &quot;14&quot;</code> è¿‡æ»¤ <code>message</code> å­—æ®µåŒ…å« <code>14</code> çš„æ—¥å¿—ã€‚</p>
<p><img src="/images/node-log-to-ek/img5.png" alt=""></p>
<h2 id="å°è£…æ›´å¥½ç”¨çš„-SDK"><a href="#å°è£…æ›´å¥½ç”¨çš„-SDK" class="headerlink" title="å°è£…æ›´å¥½ç”¨çš„ SDK"></a>å°è£…æ›´å¥½ç”¨çš„ SDK</h2><p>ä¸Šæ–‡ç®€å•å°è£…çš„ SDK æ˜¯ä¸è¶³ä»¥åº”å¯¹å®é™…ç”Ÿäº§ç¯å¢ƒçš„ï¼Œç»“åˆå®é™…ä¸šåŠ¡é‡åˆ°çš„é—®é¢˜ï¼Œæˆ‘ä»¬å°è£…äº†å†…éƒ¨ä½¿ç”¨çš„æ—¥å¿—ä¸ŠæŠ¥ SDKï¼Œæ¬¢è¿ Start &amp; Forkã€‚</p>
<ul>
<li>@za-node/express-loggerï¼šExpress æ—¥å¿—ä¸ŠæŠ¥ SDKã€‚</li>
<li>@za-node/koa-loggerï¼šKoa æ—¥å¿—ä¸ŠæŠ¥ SDKã€‚</li>
<li>@za-node/egg-frameworkï¼šåŸºæœ¬ Egg å°è£…çš„ç®€å•ä¸Šå±‚æ¡†æ¶ï¼Œä¸»è¦é›†æˆæ—¥å¿—ä¸ŠæŠ¥åŠŸèƒ½ã€‚</li>
</ul>
<p>ä¸»è¦è§£å†³äº†å¦‚ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>ctxLogger APIï¼šåœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé™¤äº†æ‰“å°çš„å†…å®¹ä»¥å¤–æˆ‘ä»¬é€šå¸¸è¿˜éœ€è¦è®°å½•æ›´å¤šè¯·æ±‚ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ¯”å¦‚æœ¬æ¬¡è¯·æ±‚çš„ç”¨æˆ·çš„ä¿¡æ¯ã€è¯·æ±‚è€—æ—¶ã€è¯·æ±‚ idã€è¯·æ±‚æ–¹æ³•ã€è¯·æ±‚è·¯ç”±ã€å“åº”ä½“ç­‰ç­‰ã€‚</li>
<li>è‡ªåŠ¨ä¸ŠæŠ¥è¯·æ±‚ã€ä¸ŠæŠ¥å“åº”ä¸­é—´ä»¶ï¼šè‡ªåŠ¨è®°å½•æ¯ä¸ªè¯·æ±‚ã€å“åº”ä¿¡æ¯ã€‚</li>
<li>æ€§èƒ½é—®é¢˜ï¼šé Serverless ç¯å¢ƒå…ˆç¼“å­˜æ—¥å¿—ï¼Œæ¯ 30s ä¸ŠæŠ¥ä¸€æ¬¡ã€‚</li>
<li>Serverless ç¯å¢ƒæ”¯æŒï¼šæˆ‘ä»¬å›¢é˜Ÿæœ‰äº›é¡¹ç›®å·²ç»è¿ç§»åˆ° Serverless ç¯å¢ƒéƒ¨ç½²ï¼ŒServerless ç¯å¢ƒè¯·æ±‚ç»“æŸå°±ä¼šé©¬ä¸Šé”€æ¯æœåŠ¡å®ä¾‹ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œåœ¨è¯·æ±‚ç»“æŸå‰ SDK ä¼šå®Œæˆæ—¥å¿—ä¸ŠæŠ¥ï¼Œä¿è¯æ—¥å¿—ä¸ä¸¢å¤±ã€‚</li>
<li>æ›´å¥½çš„ API ä½“éªŒï¼š<ul>
<li>SDK å†…éƒ¨ä½¿ç”¨ <a href="https://www.npmjs.com/package/json-stringify-safe" target="_blank" rel="noopener">json-stringify-safe</a> å°†å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–ï¼Œä¿è¯ä¸ä¼šå‡ºç°åºåˆ—åŒ–å¼‚å¸¸ã€‚</li>
<li>é’ˆå¯¹ Error å¯¹è±¡åšç‰¹æ®Šåºåˆ—åŒ–å¤„ç†ï¼Œæé«˜é”™è¯¯ä¿¡æ¯å¯è¯»æ€§ã€‚</li>
</ul>
</li>
</ul>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/targz.html" target="_blank" rel="noopener">Elasticsearch å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://www.ruanyifeng.com/blog/2017/08/elasticsearch.html" target="_blank" rel="noopener">å…¨æ–‡æœç´¢å¼•æ“ Elasticsearch å…¥é—¨æ•™ç¨‹</a></li>
<li><a href="https://www.npmjs.com/package/winston" target="_blank" rel="noopener">winston</a></li>
<li><a href="https://www.npmjs.com/package/winston-elasticsearch" target="_blank" rel="noopener">winston-elasticsearch</a></li>
<li><a href="https://www.npmjs.com/package/json-stringify-safe" target="_blank" rel="noopener">json-stringify-safe</a></li>
</ul>
<hr>
<p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å· Luobo FEï¼Œè·å–æœ€æ–°èµ„è®¯åŠ¨æ€ğŸ”¥</p>
<p><img src="/images/common/qrcode.jpg" alt=""></p>

      </div>
      <div class="post-copyright">
    <p class="copyright-item">
      <span>åŸæ–‡ä½œè€…: </span>
      <a href="http://yoursite.com">yejinzhan</a>
    </p>
    <p class="copyright-item">
      <span>åŸæ–‡é“¾æ¥: </span>
      <a href="http://yoursite.com/2022/12/05/node-log-to-ek/">http://yoursite.com/2022/12/05/node-log-to-ek/</a>
    </p>
    <p class="copyright-item">
      <span>è®¸å¯åè®®: </span><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 4.0 å›½é™…è®¸å¯åè®®</a>
    </p>
  </div>
      <footer class="post-footer">
        
        <nav class="post-nav"><a class="next" href="/2022/06/10/docker-and-k8s/">
        <span class="next-text nav-default">Docker&k8s åœ¨å‰ç«¯ CICD ä¸­çš„åº”ç”¨</span>
        <span class="prev-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></footer>
    </article></div><div class="comments" id="comments"><script src='//unpkg.com/valine/dist/Valine.min.js'></script>
      <div id="valine-container"></div>
      <script>
        var notify = false
        var verify = false
        var visitor = true
        new Valine({
          el: '#valine-container',
          notify: notify,
          verify: verify,
          appId: 'uMdsaHD1FNsezx8GJwYPHtfe-gzGzoHsz',
          appKey: 'WM7KSHWQxXSOlxGBieADbzMy',
          lang: 'zh-CN',
          placeholder: '',
          avatar: 'monsterid',
          pageSize: 10,
          recordIP: true,
          visitor: visitor
        });
       </script>
    </div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="mailto:your@email.com" class="iconfont icon-email" title="email"></a>
        <a href="https://github.com/jinzhanye" target="_blank" rel="noopener" class="iconfont icon-github" title="github"></a>
        <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    </div><div class="copyright">
  <span class="power-by">
    ç”± <a class="hexo-link" href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> å¼ºåŠ›é©±åŠ¨
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    ä¸»é¢˜ - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even" target="_blank" rel="noopener">Even</a>
  </span>

  <span class="copyright-year">&copy;2018 - 2023<span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">yejinzhan</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.0"></script>
</body>
</html>
